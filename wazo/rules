#!/usr/bin/env bash
set -euo pipefail

CMD="${1:-}"; DEST="${2:-/}"

case "$CMD" in
  install)
    # Install deps into the plugind build root
    if [ -f requirements.txt ]; then
      python3 -m pip install -r requirements.txt --root "$DEST" --prefix /usr
    fi
    # Install our package into the build root
    python3 -m pip install . --root "$DEST" --prefix /usr --no-deps
    # Enable the plugin in calld
    mkdir -p "$DEST/etc/wazo-calld/conf.d"
    install -m 0644 etc/wazo-calld/conf.d/50-hello-calld.yml \
      "$DEST/etc/wazo-calld/conf.d/50-hello-calld.yml"
    ;;
  uninstall)
    :
    ;;
  *)
    echo "usage: $0 {install|uninstall} <dest>" >&2
    exit 2
    ;;
esac
